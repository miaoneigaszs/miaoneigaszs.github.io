<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="page__footer-follow">
  <ul class="social-icons">
    {% if site.data.ui-text[site.locale].follow_label %}
      <li><strong>{{ site.data.ui-text[site.locale].follow_label }}</strong></li>
    {% endif %}

    {% if site.footer.links %}
      {% for link in site.footer.links %}
        {% if link.label and link.url %}
          <li><a href="{{ link.url }}" rel="nofollow noopener noreferrer"><i class="{{ link.icon | default: 'fas fa-link' }}" aria-hidden="true"></i> {{ link.label }}</a></li>
        {% endif %}
      {% endfor %}
    {% endif %}

    <li><a href="{{ '/feed.xml' | relative_url }}"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> {{ site.data.ui-text[site.locale].feed_label | default: "Feed" }}</a></li>
  </ul>
</div>

<div class="page__footer-copyright">
  &copy; {{ site.time | date: '%Y' }} {{ site.name | default: site.title }}. 
  Designed by <a href="https://github.com/miaoneigaszs">Cln_Nagisa</a>.

  <br>
  <span style="font-size: 0.8em; color: #888;">
    <span id="busuanzi_container_site_pv" style="display:none; color: #ffffff; opacity: 0.8;">
      <i class="fas fa-eye"></i> 本站总访问量: <span id="busuanzi_value_site_pv"></span> 次
    </span>
    &nbsp;|&nbsp;
    <span id="busuanzi_container_site_uv" style="display:none; color: #ffffff; opacity: 0.8;">
      <i class="fas fa-user"></i> 访客数: <span id="busuanzi_value_site_uv"></span> 人
    </span>
  </span>
</div>

<link rel="stylesheet" href="{{ '/assets/waifu/waifu.css' | relative_url }}">

<div class="waifu">
    <div class="waifu-tips"></div>
    <canvas id="live2d" class="live2d"></canvas>
    <div class="waifu-tool">
        <span class="fui-home"></span>
        <span class="fui-chat"></span>
        <span class="fui-eye"></span>
        <span class="fui-user"></span>
        <span class="fui-photo"></span>
        <span class="fui-info-circle"></span>
        <span class="fui-cross"></span>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/live2d.min.js"></script>

<script src="{{ '/assets/waifu/waifu-tips.js' | relative_url }}"></script>

<script type="text/javascript">
    /* 解决模糊问题：手动调整 Canvas 分辨率 */
    function fixResolution() {
        var canvas = document.getElementById("live2d");
        var wrapper = document.getElementById("waifu");
        // 获取 CSS 设置的显示大小
        var width = wrapper.clientWidth;
        var height = wrapper.clientHeight;
        // 设置 Canvas 的实际渲染像素（乘 2 是为了高清屏）
        canvas.width = width * 2;
        canvas.height = height * 2;
        // 保持样式大小不变
        canvas.style.width = width + "px";
        canvas.style.height = height + "px";
    }

    $(document).ready(function() {
        // 1. 先修复分辨率
        fixResolution();

        // 2. 初始化看板娘
        initWidget({
            // 提示语文件（用来恢复说话功能）
            waifuPath: "{{ '/assets/waifu/waifu-tips.json' | relative_url }}",
            
            // 核心路径配置
            // 这里的逻辑是：cdnPath + model[x] + /index.json
            cdnPath: "{{ '/assets/waifu/model/' | relative_url }}",
            
            // 这里填写文件夹的名字，必须完全一致！
            model: ["Violet"], 
            
            // 默认材质
            textures: [0]
        });
    });
    
    // 监听窗口大小变化，保持清晰
    window.onresize = fixResolution;
</script>

<style>
  /* 强制看板娘悬浮在左下角，不占据页面空间 */
  #waifu {
    position: fixed !important;
    bottom: 0;
    left: 0;
    z-index: 9999 !important;
    width: 280px; /* 默认宽度，可调 */
    height: 250px; /* 默认高度，可调 */
    pointer-events: none; /* 允许点击穿透空白色块 */
  }
  
  /* 让 canvas 填满容器 */
  #live2d {
    width: 280px !important; /* 必须和上面一致 */
    height: 250px !important; /* 必须和上面一致 */
    position: relative !important;
    pointer-events: auto; /* 允许点击人物 */
  }

  /* 提示框样式微调 */
  .waifu-tips {
    width: 250px;
    min-height: 70px;
    margin: -20px 20px;
    padding: 5px 10px;
    border: 1px solid rgba(224, 186, 140, 0.62);
    border-radius: 12px;
    background-color: rgba(236, 217, 188, 0.5);
    box-shadow: 0 3px 15px 2px rgba(191, 158, 118, 0.2);
    font-size: 12px;
    line-height: 24px;
    word-break: break-all;
    text-overflow: ellipsis;
    overflow: hidden;
    position: absolute;
    animation: shake 50s ease-in-out 5s infinite;
    display: none; /* 默认隐藏，JS 会控制显示 */
    pointer-events: none;
  }

  /* 移动端隐藏 */
  @media (max-width: 768px) {
    #waifu { display: none !important; }
  }
</style>