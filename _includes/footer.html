<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="page__footer-follow">
  <ul class="social-icons">
    {% if site.data.ui-text[site.locale].follow_label %}
      <li><strong>{{ site.data.ui-text[site.locale].follow_label }}</strong></li>
    {% endif %}
    {% if site.footer.links %}
      {% for link in site.footer.links %}
        {% if link.label and link.url %}
          <li><a href="{{ link.url }}" rel="nofollow noopener noreferrer"><i class="{{ link.icon | default: 'fas fa-link' }}" aria-hidden="true"></i> {{ link.label }}</a></li>
        {% endif %}
      {% endfor %}
    {% endif %}
    <li><a href="{{ '/feed.xml' | relative_url }}"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> {{ site.data.ui-text[site.locale].feed_label | default: "Feed" }}</a></li>
  </ul>
</div>

<div class="page__footer-copyright">
  &copy; {{ site.time | date: '%Y' }} {{ site.name | default: site.title }}. 
  Designed by <a href="https://github.com/miaoneigaszs">Cln_Nagisa</a>.
  <br>
  <span style="font-size: 0.8em; color: #888;">
    <span id="busuanzi_container_site_pv" style="display:none; color: #ffffff; opacity: 0.8;">
      <i class="fas fa-eye"></i> 本站总访问量: <span id="busuanzi_value_site_pv"></span> 次
    </span>
    &nbsp;|&nbsp;
    <span id="busuanzi_container_site_uv" style="display:none; color: #ffffff; opacity: 0.8;">
      <i class="fas fa-user"></i> 访客数: <span id="busuanzi_value_site_uv"></span> 人
    </span>
  </span>
</div>

<link rel="stylesheet" href="{{ '/assets/waifu/waifu.css' | relative_url }}">

<style>
  /* 强制固定在左下角，解决“多出一块”的问题 */
  #waifu {
    position: fixed !important; 
    bottom: 0;
    left: 0;
    z-index: 9999 !important;
    width: 280px;
    height: 250px;
    pointer-events: none; /* 允许鼠标穿透透明区域 */
  }
  #live2d {
    position: relative !important;
    width: 280px !important;
    height: 250px !important;
    pointer-events: auto; /* 允许点击模型 */
  }
  @media (max-width: 768px) {
    #waifu { display: none !important; }
  }
</style>

<div id="waifu" class="waifu">
    <div class="waifu-tips"></div>
    <canvas id="live2d" class="live2d"></canvas>
    <div class="waifu-tool">
        <span class="fui-home"></span>
        <span class="fui-chat"></span>
        <span class="fui-eye"></span>
        <span class="fui-user"></span>
        <span class="fui-photo"></span>
        <span class="fui-info-circle"></span>
        <span class="fui-cross"></span>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/live2d.min.js"></script>
<script src="{{ '/assets/waifu/waifu-tips.js' | relative_url }}"></script>

<script type="text/javascript">
    /* 解决模糊问题 */
    function fixResolution() {
        var canvas = document.getElementById("live2d");
        var wrapper = document.getElementById("waifu");
        if (!canvas || !wrapper) return; 
        var width = wrapper.clientWidth;
        var height = wrapper.clientHeight;
        canvas.width = width * 2; 
        canvas.height = height * 2;
        canvas.style.width = width + "px";
        canvas.style.height = height + "px";
    }

    $(document).ready(function() {
        // 清理旧缓存，解决 undefined 报错
        try { localStorage.removeItem('modelId'); localStorage.removeItem('modelTexturesId'); } catch(e) {}

        initWidget({
            waifuPath: "{{ '/assets/waifu/waifu-tips.json' | relative_url }}",
            cdnPath: "{{ '/assets/waifu/model/' | relative_url }}",
            model: ["Violet"], // 确保文件夹叫 Violet
            textures: [0]
        });
        fixResolution();
    });
    window.onresize = fixResolution;
</script>